<%= turbo_stream_from comment, :comments %>

<div class="<%= 'ps-3 border-left' unless comment.parent.nil? %>" id="<%= dom_id(comment) %>_with_comments" data-controller="comment-reply turbo-frame-visibility">
  <%= render comment %>

  <div class="text-sm mb-3">
    <%= link_to t('reply'), "#", id: "#{dom_id(comment)}_reply_button", data: { action: "click->comment-reply#toggle" } %>
  </div>

  <div id="<%= dom_id(comment) %>_comments">
    <%= render partial: "comments/form", locals: { commentable: comment, comment: Comment.new, data: { comment_reply_target: "form" }, class: "d-none" } %>
    <%= render partial: "comments/comment_with_replies", collection: comment.comments, as: :comment %>
    <!-- TODO: comment validation errors are not rendered for nested comments -->
  </div>
</div>
